<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Jeu de Devinette v3.0 - Client Web</title>

        <style>
            /**
         * ================================================================
         * CLIENT WEB ULTRA-MODERNE - JEU DE DEVINETTE v3.0
         * ================================================================
         * Interface MAGNIFIQUE avec parsing JSON !
         *
         * Auteurs: Opak (Penifana Abdoul-Khader Ouattara) & Bire Isma√´l Zie
         * √âcole: ESATIC & Universit√© C√¥te d'Azur
         * Cours: PRAD - TP1 (2025-2026)
         * ================================================================
         */

            @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Poppins", sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
                position: relative;
                overflow-x: hidden;
            }

            /* Animation de fond */
            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background:
                    radial-gradient(
                        circle at 20% 50%,
                        rgba(120, 119, 198, 0.3) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 80% 80%,
                        rgba(252, 163, 17, 0.3) 0%,
                        transparent 50%
                    );
                animation: pulse 15s ease-in-out infinite;
                z-index: 0;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            .container {
                max-width: 850px;
                width: 100%;
                position: relative;
                z-index: 1;
            }

            /* ============================================================
         * CARTE PRINCIPALE GLASSMORPHISM
         * ============================================================ */
            .card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(30px);
                border-radius: 30px;
                padding: 2.5rem;
                box-shadow:
                    0 20px 60px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
                border: 1px solid rgba(255, 255, 255, 0.3);
            }

            /* ============================================================
         * EN-T√äTE STYL√â
         * ============================================================ */
            .header {
                text-align: center;
                margin-bottom: 2rem;
            }

            h1 {
                font-size: 2.5rem;
                font-weight: 800;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                margin-bottom: 0.5rem;
                letter-spacing: -1px;
            }

            .subtitle {
                color: #666;
                font-size: 1rem;
                font-weight: 500;
            }

            /* ============================================================
         * TABLEAUX MODERNES AVEC GRID
         * ============================================================ */

            .info-card {
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                border-radius: 20px;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .info-card-title {
                font-size: 1.1rem;
                font-weight: 700;
                color: #667eea;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            /* Tableau avec Grid moderne */
            .info-grid {
                display: grid;
                gap: 0.75rem;
            }

            .info-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                background: white;
                padding: 1rem;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
            }

            .info-row:hover {
                transform: translateX(5px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            }

            .info-label {
                color: #666;
                font-weight: 600;
            }

            .info-value {
                color: #333;
                font-weight: 700;
                text-align: right;
            }

            /* ============================================================
         * STATS EN TEMPS R√âEL - CARTES MODERNES
         * ============================================================ */
            .stats-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }

            .stat-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: 1.5rem;
                text-align: center;
                color: white;
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
                transition: all 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            }

            .stat-value {
                font-size: 3rem;
                font-weight: 800;
                line-height: 1;
                margin-bottom: 0.5rem;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }

            .stat-label {
                font-size: 0.9rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 1px;
                opacity: 0.9;
            }

            /* ============================================================
         * LEADERBOARD TABLE MODERNE
         * ============================================================ */
            .leaderboard {
                background: white;
                border-radius: 20px;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .leaderboard-title {
                font-size: 1.3rem;
                font-weight: 700;
                color: #667eea;
                margin-bottom: 1rem;
                text-align: center;
            }

            .leaderboard-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0 0.5rem;
            }

            .leaderboard-table th {
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                padding: 0.75rem;
                text-align: left;
                font-weight: 700;
                color: #667eea;
                font-size: 0.9rem;
            }

            .leaderboard-table th:first-child {
                border-radius: 10px 0 0 10px;
            }

            .leaderboard-table th:last-child {
                border-radius: 0 10px 10px 0;
            }

            .leaderboard-table td {
                background: #f8f9fa;
                padding: 0.75rem;
                border-bottom: 1px solid #e9ecef;
            }

            .leaderboard-table tbody tr {
                transition: all 0.3s ease;
            }

            .leaderboard-table tbody tr:hover {
                background: #f0f4f8;
                transform: scale(1.02);
            }

            .leaderboard-table td:first-child {
                border-radius: 10px 0 0 10px;
                font-size: 1.2rem;
            }

            .leaderboard-table td:last-child {
                border-radius: 0 10px 10px 0;
            }

            /* ============================================================
         * FORMULAIRES MODERNES
         * ============================================================ */
            .form-group {
                margin-bottom: 1.25rem;
            }

            label {
                display: block;
                margin-bottom: 0.5rem;
                color: #333;
                font-weight: 600;
                font-size: 0.95rem;
            }

            input {
                width: 100%;
                padding: 1rem;
                background: white;
                border: 2px solid #e9ecef;
                border-radius: 15px;
                color: #333;
                font-size: 1rem;
                font-family: "Poppins", sans-serif;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            }

            /* ============================================================
         * BOUTONS ULTRA-MODERNES
         * ============================================================ */
            .btn {
                width: 100%;
                padding: 1.2rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                border-radius: 15px;
                color: white;
                font-size: 1.1rem;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .btn:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
            }

            .btn:active:not(:disabled) {
                transform: translateY(-1px);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .btn-secondary {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                margin-top: 1rem;
            }

            .btn-success {
                background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                margin-top: 1rem;
            }

            /* ============================================================
         * STATUS BADGE
         * ============================================================ */
            .status {
                text-align: center;
                padding: 1rem;
                border-radius: 15px;
                margin-bottom: 1.5rem;
                font-weight: 700;
                font-size: 1rem;
            }

            .status.connected {
                background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                color: white;
                box-shadow: 0 5px 20px rgba(67, 233, 123, 0.3);
            }

            .status.connecting {
                background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                color: white;
                box-shadow: 0 5px 20px rgba(250, 112, 154, 0.3);
            }

            /* ============================================================
         * CHAT BOX MODERNE
         * ============================================================ */
            .chat-box {
                background: #f8f9fa;
                border-radius: 20px;
                height: 350px;
                overflow-y: auto;
                padding: 1rem;
                margin-bottom: 1.5rem;
                border: 2px solid #e9ecef;
                box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
            }

            .chat-box::-webkit-scrollbar {
                width: 8px;
            }

            .chat-box::-webkit-scrollbar-track {
                background: #f1f3f5;
                border-radius: 10px;
            }

            .chat-box::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 10px;
            }

            .message {
                margin-bottom: 0.75rem;
                padding: 1rem;
                border-radius: 15px;
                animation: slideIn 0.3s ease;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .message.server {
                background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
                border-left: 4px solid #2196f3;
                color: #1565c0;
            }

            .message.client {
                background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
                border-left: 4px solid #9c27b0;
                color: #6a1b9a;
            }

            .message.error {
                background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
                border-left: 4px solid #f44336;
                color: #c62828;
            }

            .message.success {
                background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
                border-left: 4px solid #4caf50;
                color: #2e7d32;
            }

            /* ============================================================
         * SECTIONS
         * ============================================================ */
            .section {
                display: none;
            }

            .section.active {
                display: block;
            }

            /* ============================================================
         * FOOTER
         * ============================================================ */
            .footer {
                text-align: center;
                margin-top: 2rem;
                padding-top: 1.5rem;
                border-top: 2px solid #e9ecef;
                color: #666;
                font-size: 0.9rem;
            }

            .footer strong {
                color: #667eea;
            }

            /* ============================================================
         * ANIMATION CONFETTIS
         * ============================================================ */
            @keyframes confetti-fall {
                0% {
                    top: -10px;
                    opacity: 1;
                }
                100% {
                    top: 100vh;
                    opacity: 0;
                    transform: rotate(720deg);
                }
            }

            /* ============================================================
         * RESPONSIVE PERFECTIONN√â
         * ============================================================ */
            @media (max-width: 768px) {
                body {
                    padding: 0.5rem;
                }

                .card {
                    padding: 1.5rem;
                    border-radius: 20px;
                }

                h1 {
                    font-size: 1.75rem;
                }

                .stats-container {
                    grid-template-columns: 1fr;
                }

                .stat-value {
                    font-size: 2.5rem;
                }

                .info-row {
                    grid-template-columns: 1fr;
                    text-align: center;
                }

                .info-value {
                    text-align: center;
                }

                .chat-box {
                    height: 250px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="card">
                <!-- EN-T√äTE -->
                <div class="header">
                    <h1>üéÆ Jeu de Devinette</h1>
                    <p class="subtitle">
                        Client Web Ultra-Moderne v3.0 ‚Ä¢ Architecture JSON
                    </p>
                </div>

                <!-- R√àGLES DU JEU -->
                <div class="info-card">
                    <div class="info-card-title">üìã R√®gles du jeu</div>
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-label">Plage</div>
                            <div class="info-value">0 - 100</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">Format du nom</div>
                            <div class="info-value">3-10 lettres (a-z)</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">Calcul du score</div>
                            <div class="info-value">
                                10000 - (essais √ó 100) - temps
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">Commandes</div>
                            <div class="info-value">stats ‚Ä¢ quit</div>
                        </div>
                    </div>
                </div>

                <!-- SECTION CONNEXION -->
                <div id="connectionSection" class="section active">
                    <div class="form-group">
                        <label for="wsHost">üåê Adresse IP du serveur</label>
                        <input
                            type="text"
                            id="wsHost"
                            placeholder="localhost ou 192.168.x.x"
                            value="localhost"
                        />
                    </div>

                    <div class="form-group">
                        <label for="wsPort">üîå Port WebSocket</label>
                        <input
                            type="number"
                            id="wsPort"
                            placeholder="8081"
                            value="8081"
                        />
                    </div>

                    <button class="btn" onclick="connectToServer()">
                        üöÄ Se connecter
                    </button>
                </div>

                <!-- SECTION JEU -->
                <div id="gameSection" class="section">
                    <div id="status" class="status connecting">
                        ‚è≥ Connexion en cours...
                    </div>

                    <!-- STATS EN TEMPS R√âEL -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-value" id="attempts">0</div>
                            <div class="stat-label">Tentatives</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="timer">0s</div>
                            <div class="stat-label">Temps √©coul√©</div>
                        </div>
                    </div>

                    <!-- LEADERBOARD -->
                    <div
                        id="leaderboardContainer"
                        class="leaderboard"
                        style="display: none"
                    >
                        <div class="leaderboard-title">üèÜ Top Scores</div>
                        <table class="leaderboard-table" id="leaderboardTable">
                            <thead>
                                <tr>
                                    <th>üèÖ</th>
                                    <th>Joueur</th>
                                    <th>Score</th>
                                    <th>Essais</th>
                                    <th>Temps</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody"></tbody>
                        </table>
                    </div>

                    <!-- CHAT -->
                    <div id="chatBox" class="chat-box"></div>

                    <!-- INPUT -->
                    <div class="form-group">
                        <label for="messageInput">üí¨ Votre r√©ponse</label>
                        <input
                            type="text"
                            id="messageInput"
                            placeholder="Entrez votre nom ou un nombre..."
                            disabled
                        />
                    </div>

                    <button
                        class="btn"
                        id="sendBtn"
                        onclick="sendMessage()"
                        disabled
                    >
                        üì§ Envoyer
                    </button>

                    <button
                        class="btn btn-secondary"
                        id="disconnectBtn"
                        onclick="disconnect()"
                        disabled
                    >
                        üîå D√©connecter
                    </button>

                    <button
                        class="btn btn-success"
                        id="retryBtn"
                        onclick="retry()"
                        style="display: none"
                    >
                        üîÑ Rejouer
                    </button>
                </div>

                <!-- FOOTER -->
                <div class="footer">
                    <p>
                        D√©velopp√© par <strong>Opak</strong> &
                        <strong>Bire Isma√´l Zie</strong><br />
                        ESATIC & Universit√© C√¥te d'Azur ‚Ä¢ PRAD TP1 ‚Ä¢ 2025-2026
                    </p>
                </div>
            </div>
        </div>

        <script>
            /**
             * ================================================================
             * CLIENT WEB JAVASCRIPT - Parsing JSON
             * ================================================================
             */

            let ws = null;
            let attempts = 0;
            let startTime = null;
            let timerInterval = null;
            let isConnected = false;
            let gameStarted = false;
            let playerName = "";

            function addMessage(text, type = "server") {
                const chatBox = document.getElementById("chatBox");
                const message = document.createElement("div");
                message.className = `message ${type}`;
                message.textContent = text;
                chatBox.appendChild(message);
                chatBox.scrollTop = chatBox.scrollHeight;
            }

            function updateStatus(text, type) {
                const status = document.getElementById("status");
                status.className = `status ${type}`;
                status.textContent = text;
            }

            function startTimer() {
                if (timerInterval) clearInterval(timerInterval);
                startTime = Date.now();
                timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    document.getElementById("timer").textContent =
                        elapsed + "s";
                }, 1000);
            }

            function stopTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }

            function displayLeaderboard(data) {
                const container = document.getElementById(
                    "leaderboardContainer",
                );
                const tbody = document.getElementById("leaderboardBody");
                tbody.innerHTML = "";

                if (data.count === 0) {
                    container.style.display = "none";
                    return;
                }

                container.style.display = "block";

                data.scores.forEach((score) => {
                    const medal =
                        score.rank === 1
                            ? "ü•á"
                            : score.rank === 2
                              ? "ü•à"
                              : score.rank === 3
                                ? "ü•â"
                                : `#${score.rank}`;
                    const row = tbody.insertRow();
                    row.innerHTML = `
                    <td>${medal}</td>
                    <td><strong>${score.name}</strong></td>
                    <td>${score.score} pts</td>
                    <td>${score.attempts}</td>
                    <td>${score.duration}s</td>
                `;
                });
            }

            function connectToServer() {
                const serverHost = document
                    .getElementById("wsHost")
                    .value.trim();
                const serverPort = document
                    .getElementById("wsPort")
                    .value.trim();

                if (!serverHost || !serverPort) {
                    alert("‚ùå Veuillez remplir tous les champs");
                    return;
                }

                const wsUrl = `ws://${serverHost}:${serverPort}`;
                updateStatus("‚è≥ Connexion en cours...", "connecting");

                try {
                    ws = new WebSocket(wsUrl);

                    ws.onopen = () => {
                        isConnected = true;
                        updateStatus("‚úÖ Connect√© au serveur", "connected");

                        document.getElementById(
                            "connectionSection",
                        ).style.display = "none";
                        document
                            .getElementById("gameSection")
                            .classList.add("active");

                        document.getElementById("messageInput").disabled =
                            false;
                        document.getElementById("sendBtn").disabled = false;
                        document.getElementById("disconnectBtn").disabled =
                            false;
                        document.getElementById("messageInput").focus();
                    };

                    ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            handleJsonMessage(data);
                        } catch (e) {
                            console.error("JSON parse error:", e);
                        }
                    };

                    ws.onerror = () => {
                        addMessage("‚ùå Erreur de connexion", "error");
                        updateStatus("‚ùå Erreur", "connecting");
                    };

                    ws.onclose = () => {
                        isConnected = false;
                        stopTimer();
                        updateStatus("‚ö†Ô∏è D√©connect√©", "connecting");
                        document.getElementById("messageInput").disabled = true;
                        document.getElementById("sendBtn").disabled = true;
                        document.getElementById("disconnectBtn").disabled =
                            true;
                    };
                } catch (error) {
                    addMessage("‚ùå Erreur: " + error.message, "error");
                }
            }

            function handleJsonMessage(data) {
                const type = data.type;

                if (type === "stats") {
                    // Stats serveur (on peut les afficher ou pas)
                    console.log("Stats:", data);
                } else if (type === "leaderboard") {
                    displayLeaderboard(data);
                } else if (type === "prompt") {
                    addMessage(data.message, "server");
                } else if (type === "name_accepted") {
                    playerName = data.name;
                    addMessage(`‚úÖ Bienvenue ${data.name} !`, "success");
                } else if (type === "game_start") {
                    gameStarted = true;
                    startTimer();
                    attempts = 0;
                    document.getElementById("attempts").textContent = "0";
                    addMessage(
                        `üéÆ Partie d√©marr√©e ! Devinez entre ${data.min} et ${data.max}`,
                        "server",
                    );
                } else if (type === "hint") {
                    attempts = data.attempts;
                    document.getElementById("attempts").textContent = attempts;

                    const direction =
                        data.direction === "grand"
                            ? "üìâ Trop grand !"
                            : "üìà Trop petit !";
                    addMessage(
                        `${direction} (Tentative #${data.attempts})`,
                        "server",
                    );
                } else if (type === "victory") {
                    stopTimer();
                    gameStarted = false;
                    addMessage(
                        `üéâ VICTOIRE ! Nombre: ${data.number} | Score: ${data.score} pts`,
                        "success",
                    );

                    document.getElementById("messageInput").disabled = true;
                    document.getElementById("sendBtn").disabled = true;

                    setTimeout(() => {
                        celebrate();
                        document.getElementById("retryBtn").style.display =
                            "block";
                    }, 1000);
                } else if (type === "error") {
                    addMessage(`‚ùå ${data.message}`, "error");
                } else if (type === "bye") {
                    addMessage(`üëã ${data.message}`, "server");
                }
            }

            function sendMessage() {
                const input = document.getElementById("messageInput");
                const message = input.value.trim();

                if (
                    !message ||
                    !isConnected ||
                    ws.readyState !== WebSocket.OPEN
                ) {
                    return;
                }

                addMessage(`‚û§ ${message}`, "client");
                ws.send(message);

                input.value = "";
                input.focus();
            }

            function disconnect() {
                if (ws && isConnected) {
                    ws.close(1000);
                }
            }

            function retry() {
                if (!playerName) return;

                document.getElementById("retryBtn").style.display = "none";
                document.getElementById("chatBox").innerHTML = "";
                attempts = 0;
                document.getElementById("attempts").textContent = "0";
                document.getElementById("timer").textContent = "0s";
                gameStarted = false;

                disconnect();

                setTimeout(() => {
                    connectToServer();
                    setTimeout(() => {
                        if (isConnected && ws.readyState === WebSocket.OPEN) {
                            ws.send(playerName);
                        }
                    }, 2000);
                }, 1000);
            }

            function celebrate() {
                const colors = [
                    "#667eea",
                    "#764ba2",
                    "#f093fb",
                    "#f5576c",
                    "#43e97b",
                ];

                for (let i = 0; i < 80; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement("div");
                        confetti.style.position = "fixed";
                        confetti.style.width = "12px";
                        confetti.style.height = "12px";
                        confetti.style.left = Math.random() * 100 + "%";
                        confetti.style.top = "-10px";
                        confetti.style.backgroundColor =
                            colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.borderRadius = "50%";
                        confetti.style.animation = "confetti-fall 3s linear";
                        confetti.style.zIndex = "9999";
                        confetti.style.boxShadow = "0 0 10px rgba(0,0,0,0.3)";

                        document.body.appendChild(confetti);
                        setTimeout(() => confetti.remove(), 3000);
                    }, i * 30);
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                document
                    .getElementById("messageInput")
                    .addEventListener("keypress", (e) => {
                        if (e.key === "Enter") sendMessage();
                    });
            });
        </script>
    </body>
</html>
